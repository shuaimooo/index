<!doctype html>
<html lang="zh-TW" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>重量換算與價格計算器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            box-sizing: border-box;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto">
  <div class="w-full min-h-full p-4">
   <div class="max-w-6xl mx-auto">
    <h1 id="mainTitle" class="text-4xl font-bold text-center mb-8">重量換算與價格計算器</h1><!-- 第一排：原有三個計算器 -->
    <div class="grid md:grid-cols-3 gap-6 mb-8"><!-- 1. 重量換算 -->
     <div class="rounded-xl shadow-lg p-6">
      <h3 id="converterTitle" class="text-xl font-semibold text-white mb-4 text-center">重量換算</h3>
      <div class="space-y-4">
       <div><label for="convertWeight" class="block text-sm font-medium text-white mb-2">重量</label>
        <div class="relative"><input type="number" id="convertWeight" placeholder="重量" min="0" step="0.1" class="w-full px-4 py-2 pr-10 bg-opacity-30 bg-white text-white placeholder-gray-200 rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <button type="button" onclick="clearInput('convertWeight')" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-200 hover:text-white">✕</button>
        </div>
       </div>
       <div><label for="convertUnit" class="block text-sm font-medium text-white mb-2">單位</label> <select id="convertUnit" class="w-full px-4 py-2 bg-opacity-30 bg-white text-white rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <option value="公斤">公斤</option> <option value="斤">斤</option> <option value="克">克</option> <option value="兩">兩</option> </select>
       </div>
       <div class="bg-white bg-opacity-20 rounded-lg p-3">
        <div id="convertResult" class="text-white text-sm space-y-1">
         <div>
          公斤: <span id="resultKg">-</span>
         </div>
         <div>
          斤: <span id="resultJin">-</span>
         </div>
         <div>
          克: <span id="resultGram">-</span>
         </div>
         <div>
          兩: <span id="resultLiang">-</span>
         </div>
        </div>
       </div>
      </div>
     </div><!-- 2. 設定基準價格 -->
     <div class="rounded-xl shadow-lg p-6">
      <h3 id="basePriceTitle" class="text-xl font-semibold text-white mb-4 text-center">設定基準價格</h3>
      <div class="space-y-4">
       <div><label for="baseWeight" class="block text-sm font-medium text-white mb-2">重量</label>
        <div class="relative"><input type="number" id="baseWeight" placeholder="重量" min="0" step="0.1" class="w-full px-4 py-2 pr-10 bg-opacity-30 bg-white text-white placeholder-gray-200 rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <button type="button" onclick="clearInput('baseWeight')" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-200 hover:text-white">✕</button>
        </div>
       </div>
       <div><label for="baseUnit" class="block text-sm font-medium text-white mb-2">單位</label> <select id="baseUnit" class="w-full px-4 py-2 bg-opacity-30 bg-white text-white rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <option value="公斤">公斤</option> <option value="斤">斤</option> <option value="克">克</option> <option value="兩">兩</option> </select>
       </div>
       <div><label for="basePrice" class="block text-sm font-medium text-white mb-2">價格 ($)</label>
        <div class="relative"><input type="number" id="basePrice" placeholder="價格" min="0" step="0.01" class="w-full px-4 py-2 pr-10 bg-opacity-30 bg-white text-white placeholder-gray-200 rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <button type="button" onclick="clearInput('basePrice')" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-200 hover:text-white">✕</button>
        </div>
       </div>
       <div class="bg-white bg-opacity-20 rounded-lg p-3">
        <div class="text-white text-sm">
         <div>
          每公斤: $<span id="pricePerKg">-</span>
         </div>
        </div>
       </div>
      </div>
     </div><!-- 3. 計算價格 -->
     <div class="rounded-xl shadow-lg p-6">
      <h3 id="calculatePriceTitle" class="text-xl font-semibold text-white mb-4 text-center">計算價格</h3>
      <div class="space-y-4">
       <div><label for="calcWeight" class="block text-sm font-medium text-white mb-2">重量</label>
        <div class="relative"><input type="number" id="calcWeight" placeholder="重量" min="0" step="0.1" class="w-full px-4 py-2 pr-10 bg-opacity-30 bg-white text-white placeholder-gray-200 rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <button type="button" onclick="clearInput('calcWeight')" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-200 hover:text-white">✕</button>
        </div>
       </div>
       <div><label for="calcUnit" class="block text-sm font-medium text-white mb-2">單位</label> <select id="calcUnit" class="w-full px-4 py-2 bg-opacity-30 bg-white text-white rounded-lg border border-white border-opacity-30 focus:border-opacity-60 focus:outline-none"> <option value="公斤">公斤</option> <option value="斤">斤</option> <option value="克">克</option> <option value="兩">兩</option> </select>
       </div>
       <div class="bg-white bg-opacity-20 rounded-lg p-3">
        <div class="text-white">
         <div class="text-lg font-semibold">
          總價: $<span id="totalPrice">-</span>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div><!-- 第二排：新增的三個計算器 -->
    <div class="grid md:grid-cols-3 gap-6 mb-8"><!-- 4. 屠體計算 -->
     <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 id="carcassTitle" class="text-xl font-semibold text-center mb-2">屠體計算金額</h3>
      <div class="text-sm text-center mb-4">
       x × 3.6 + 30 × y = 金額
      </div>
      <div class="space-y-4">
       <div><label for="carcassX" class="block text-sm font-medium mb-2">斤 (單位)</label>
        <div class="relative"><input type="number" id="carcassX" step="0.1" min="0" class="w-full px-4 py-2 pr-10 border rounded-lg focus:ring-2 focus:outline-none" placeholder=""> <button type="button" onclick="clearInput('carcassX')" class="absolute right-2 top-1/2 transform -translate-y-1/2 hover:text-gray-600">✕</button>
        </div>
       </div>
       <div><label for="carcassY" class="block text-sm font-medium mb-2">隻 (單位)</label>
        <div class="relative"><input type="number" id="carcassY" step="0.1" min="0" class="w-full px-4 py-2 pr-10 border rounded-lg focus:ring-2 focus:outline-none" placeholder=""> <button type="button" onclick="clearInput('carcassY')" class="absolute right-2 top-1/2 transform -translate-y-1/2 hover:text-gray-600">✕</button>
        </div>
       </div>
       <div class="rounded-lg p-3">
        <div id="carcassResult" class="font-medium text-lg">
         金額: $-
        </div>
       </div>
      </div>
     </div><!-- 5. 熟雞計算 -->
     <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 id="cookedTitle" class="text-xl font-semibold text-center mb-2">熟雞計算金額</h3>
      <div class="text-sm text-center mb-4">
       x × 4 + 60 × y = 金額
      </div>
      <div class="space-y-4">
       <div><label for="cookedX" class="block text-sm font-medium mb-2">斤 (單位)</label>
        <div class="relative"><input type="number" id="cookedX" step="0.1" min="0" class="w-full px-4 py-2 pr-10 border rounded-lg focus:ring-2 focus:outline-none" placeholder=""> <button type="button" onclick="clearInput('cookedX')" class="absolute right-2 top-1/2 transform -translate-y-1/2 hover:text-gray-600">✕</button>
        </div>
       </div>
       <div><label for="cookedY" class="block text-sm font-medium mb-2">隻 (單位)</label>
        <div class="relative"><input type="number" id="cookedY" step="0.1" min="0" class="w-full px-4 py-2 pr-10 border rounded-lg focus:outline-none" placeholder=""> <button type="button" onclick="clearInput('cookedY')" class="absolute right-2 top-1/2 transform -translate-y-1/2 hover:text-gray-600">✕</button>
        </div>
       </div>
       <div class="rounded-lg p-3">
        <div id="cookedResult" class="font-medium text-lg">
         金額: $-
        </div>
       </div>
      </div>
     </div><!-- 6. 雜雞換算 -->
     <div class="bg-white rounded-xl shadow-lg p-6">
      <h3 id="chickenYieldTitle" class="text-xl font-semibold text-center mb-4">雜雞換算</h3>
      <div class="space-y-4">
       <div><label for="carcassKg" class="block text-sm font-medium mb-2">屠體重量（kg）</label> <input type="number" id="carcassKg" step="0.01" min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none" placeholder="">
       </div>
       <div><label for="livePrice" class="block text-sm font-medium mb-2">毛雞一斤價格（元/斤）</label> <input type="number" id="livePrice" step="0.1" min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none" placeholder="">
       </div>
       <div><label class="block text-sm font-medium mb-2"> 屠宰率：<strong><span id="yieldLabel">72</span>%</strong> </label> <input type="range" id="yieldSlider" min="65" max="80" step="0.5" value="72" class="w-full h-2 rounded-lg appearance-none cursor-pointer" style="background: linear-gradient(to right, #3b82f6 0%, #3b82f6 50%, #d1d5db 50%, #d1d5db 100%);">
       </div>
       <div class="rounded-lg p-3 space-y-2">
        <div id="liveKg" class="font-medium text-sm"></div>
        <div id="carcassPrice" class="font-medium text-sm"></div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // 換算係數 (以公斤為基準)
        const conversionRates = {
            '公斤': 1,
            '斤': 0.6,
            '克': 0.001,
            '兩': 0.0375
        };

        let pricePerKg = 0;

        function clearInput(id) {
            document.getElementById(id).value = '';
            if (id === 'convertWeight') {
                updateConversion();
            } else if (id === 'baseWeight' || id === 'basePrice') {
                updateBasePrice();
            } else if (id === 'calcWeight') {
                updateCalculation();
            } else if (id === 'carcassX' || id === 'carcassY') {
                updateCarcassCalculation();
            } else if (id === 'cookedX' || id === 'cookedY') {
                updateCookedCalculation();
            }
        }

        function toKg(weight, unit) {
            return weight * conversionRates[unit];
        }

        function fromKg(kg, unit) {
            return kg / conversionRates[unit];
        }

        function updateConversion() {
            const weight = parseFloat(document.getElementById('convertWeight').value);
            const unit = document.getElementById('convertUnit').value;

            if (isNaN(weight) || weight < 0) {
                document.getElementById('resultKg').textContent = '-';
                document.getElementById('resultJin').textContent = '-';
                document.getElementById('resultGram').textContent = '-';
                document.getElementById('resultLiang').textContent = '-';
                return;
            }

            const kg = toKg(weight, unit);
            document.getElementById('resultKg').textContent = kg.toFixed(3);
            document.getElementById('resultJin').textContent = fromKg(kg, '斤').toFixed(3);
            document.getElementById('resultGram').textContent = fromKg(kg, '克').toFixed(2);
            document.getElementById('resultLiang').textContent = fromKg(kg, '兩').toFixed(3);
        }

        function updateBasePrice() {
            const weight = parseFloat(document.getElementById('baseWeight').value);
            const unit = document.getElementById('baseUnit').value;
            const price = parseFloat(document.getElementById('basePrice').value);

            if (isNaN(weight) || weight <= 0 || isNaN(price) || price < 0) {
                document.getElementById('pricePerKg').textContent = '-';
                pricePerKg = 0;
                updateCalculation();
                return;
            }

            const kg = toKg(weight, unit);
            pricePerKg = price / kg;
            document.getElementById('pricePerKg').textContent = pricePerKg.toFixed(2);
            updateCalculation();
        }

        function updateCalculation() {
            const weight = parseFloat(document.getElementById('calcWeight').value);
            const unit = document.getElementById('calcUnit').value;

            if (isNaN(weight) || weight < 0 || pricePerKg === 0) {
                document.getElementById('totalPrice').textContent = '-';
                return;
            }

            const kg = toKg(weight, unit);
            const totalPrice = kg * pricePerKg;
            document.getElementById('totalPrice').textContent = totalPrice.toFixed(2);
        }

        function updateCarcassCalculation() {
            const x = parseFloat(document.getElementById('carcassX').value) || 0;
            const y = parseFloat(document.getElementById('carcassY').value) || 0;

            if (x === 0 && y === 0) {
                document.getElementById('carcassResult').textContent = '金額: $-';
                return;
            }

            const result = x * 3.6 + 30 * y;
            document.getElementById('carcassResult').textContent = `金額: $${result.toFixed(2)}`;
        }

        function updateCookedCalculation() {
            const x = parseFloat(document.getElementById('cookedX').value) || 0;
            const y = parseFloat(document.getElementById('cookedY').value) || 0;

            if (x === 0 && y === 0) {
                document.getElementById('cookedResult').textContent = '金額: $-';
                return;
            }

            const result = x * 4 + 60 * y;
            document.getElementById('cookedResult').textContent = `金額: $${result.toFixed(2)}`;
        }

        document.getElementById('convertWeight').addEventListener('input', updateConversion);
        document.getElementById('convertUnit').addEventListener('change', updateConversion);
        
        document.getElementById('baseWeight').addEventListener('input', updateBasePrice);
        document.getElementById('baseUnit').addEventListener('change', updateBasePrice);
        document.getElementById('basePrice').addEventListener('input', updateBasePrice);
        
        document.getElementById('calcWeight').addEventListener('input', updateCalculation);
        document.getElementById('calcUnit').addEventListener('change', updateCalculation);

        document.getElementById('carcassX').addEventListener('input', updateCarcassCalculation);
        document.getElementById('carcassY').addEventListener('input', updateCarcassCalculation);

        document.getElementById('cookedX').addEventListener('input', updateCookedCalculation);
        document.getElementById('cookedY').addEventListener('input', updateCookedCalculation);

        function updateChickenYieldCalculation() {
            const carcassKg = parseFloat(document.getElementById("carcassKg").value);
            const livePrice = parseFloat(document.getElementById("livePrice").value);
            const yieldRate = parseFloat(document.getElementById("yieldSlider").value) / 100;

            document.getElementById("yieldLabel").innerText =
                (yieldRate * 100).toFixed(1).replace(".0","");

            const slider = document.getElementById("yieldSlider");
            const percentage = ((slider.value - slider.min) / (slider.max - slider.min)) * 100;
            slider.style.background = `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${percentage}%, #d1d5db ${percentage}%, #d1d5db 100%)`;

            if (!carcassKg || !livePrice) {
                document.getElementById("liveKg").innerText = "";
                document.getElementById("carcassPrice").innerText = "";
                return;
            }

            const liveKg = carcassKg / yieldRate;
            const carcassJinPrice = livePrice / yieldRate;

            document.getElementById("liveKg").innerText =
                `推算活雞重量：約 ${liveKg.toFixed(2)} kg`;

            document.getElementById("carcassPrice").innerText =
                `屠體一斤成本：約 ${carcassJinPrice.toFixed(1)} 元`;
        }

        document.getElementById("carcassKg").addEventListener('input', updateChickenYieldCalculation);
        document.getElementById("livePrice").addEventListener('input', updateChickenYieldCalculation);
        document.getElementById("yieldSlider").addEventListener('input', updateChickenYieldCalculation);
        document.getElementById("yieldSlider").addEventListener('change', updateChickenYieldCalculation);

        const defaultConfig = {
            main_title: '重量換算與價格計算器',
            converter_title: '重量換算',
            base_price_title: '設定基準價格',
            calculate_price_title: '計算價格',
            carcass_title: '屠體計算金額',
            cooked_title: '熟雞計算金額',
            chicken_yield_title: '雜雞換算',
            background_color: '#eff6ff',
            card1_color: '#1e40af',
            card2_color: '#059669',
            card3_color: '#7c3aed',
            card4_color: '#8b5cf6',
            card5_color: '#10b981'
        };

        async function onConfigChange(config) {
            document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
            document.getElementById('converterTitle').textContent = config.converter_title || defaultConfig.converter_title;
            document.getElementById('basePriceTitle').textContent = config.base_price_title || defaultConfig.base_price_title;
            document.getElementById('calculatePriceTitle').textContent = config.calculate_price_title || defaultConfig.calculate_price_title;
            document.getElementById('carcassTitle').textContent = config.carcass_title || defaultConfig.carcass_title;
            document.getElementById('cookedTitle').textContent = config.cooked_title || defaultConfig.cooked_title;
            document.getElementById('chickenYieldTitle').textContent = config.chicken_yield_title || defaultConfig.chicken_yield_title;

            const bgColor = config.background_color || defaultConfig.background_color;
            const card1Color = config.card1_color || defaultConfig.card1_color;
            const card2Color = config.card2_color || defaultConfig.card2_color;
            const card3Color = config.card3_color || defaultConfig.card3_color;
            const card4Color = config.card4_color || defaultConfig.card4_color;
            const card5Color = config.card5_color || defaultConfig.card5_color;

            document.body.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${card1Color}20 100%)`;
            
            const cards = document.querySelectorAll('.rounded-xl');
            if (cards[0]) cards[0].style.backgroundColor = card1Color;
            if (cards[1]) cards[1].style.backgroundColor = card2Color;
            if (cards[2]) cards[2].style.backgroundColor = card3Color;
            if (cards[3]) cards[3].style.backgroundColor = card4Color;
            if (cards[4]) cards[4].style.backgroundColor = card5Color;
            if (cards[5]) {
                cards[5].style.backgroundColor = '#ffffff';
                cards[5].style.borderColor = card1Color;
                cards[5].style.borderWidth = '2px';
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.card1_color || defaultConfig.card1_color,
                        set: (value) => {
                            config.card1_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ card1_color: value });
                        }
                    },
                    {
                        get: () => config.card2_color || defaultConfig.card2_color,
                        set: (value) => {
                            config.card2_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ card2_color: value });
                        }
                    },
                    {
                        get: () => config.card3_color || defaultConfig.card3_color,
                        set: (value) => {
                            config.card3_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ card3_color: value });
                        }
                    },
                    {
                        get: () => config.card4_color || defaultConfig.card4_color,
                        set: (value) => {
                            config.card4_color = value;
                            if (window.elementSdk) window.elementSdk.setConfig({ card4_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ['main_title', config.main_title || defaultConfig.main_title],
                ['converter_title', config.converter_title || defaultConfig.converter_title],
                ['base_price_title', config.base_price_title || defaultConfig.base_price_title],
                ['calculate_price_title', config.calculate_price_title || defaultConfig.calculate_price_title],
                ['carcass_title', config.carcass_title || defaultConfig.carcass_title],
                ['cooked_title', config.cooked_title || defaultConfig.cooked_title],
                ['chicken_yield_title', config.chicken_yield_title || defaultConfig.chicken_yield_title]
            ]);
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9be18b007373f06f',t:'MTc2ODQzOTk0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
