<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„ªé®®é›è‚‰æ‰¹ç™¼ç®¡ç†ç³»çµ± - Excelè¡¨æ ¼ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.9); }
        .slide-in { animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .bounce-in { animation: bounceIn 0.5s ease-out; }
        @keyframes bounceIn { 
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        
        /* Excelé¢¨æ ¼è¡¨æ ¼æ¨£å¼ */
        .excel-table { border-collapse: collapse; }
        .excel-table th, .excel-table td { 
            border: 1px solid #d1d5db; 
            padding: 8px 12px; 
            text-align: left;
            position: relative;
        }
        .excel-table th { 
            background: #f3f4f6; 
            font-weight: 600;
            user-select: none;
        }
        .excel-table td { 
            background: white;
            min-width: 120px;
        }
        .excel-table td:hover { background: #f8fafc; }
        .excel-table td.selected { background: #dbeafe !important; }
        .excel-table tr.selected { background: #dbeafe; }
        
        .excel-input {
            border: none;
            background: transparent;
            width: 100%;
            padding: 4px;
            font-size: 14px;
        }
        .excel-input:focus {
            outline: 2px solid #3b82f6;
            background: white;
        }
        
        .column-header {
            cursor: pointer;
            user-select: none;
        }
        .column-header:hover {
            background: #e5e7eb;
        }
        
        .row-number {
            background: #f9fafb;
            color: #6b7280;
            font-weight: 500;
            text-align: center;
            width: 50px;
            cursor: pointer;
        }
        .row-number:hover {
            background: #e5e7eb;
        }
        
        .print-only { display: none; }
        @media print {
            body * { visibility: hidden; }
            .print-content, .print-content * { visibility: visible; }
            .print-content { position: absolute; left: 0; top: 0; width: 100%; }
            .print-only { display: block !important; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">
    <!-- é ‚éƒ¨å°èˆª -->
    <header class="glass-effect border-b border-white/20 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center text-white text-2xl font-bold">
                        ğŸ”
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">å„ªé®®é›è‚‰æ‰¹ç™¼ - Excelè¡¨æ ¼ç‰ˆ</h1>
                        <p class="text-sm text-gray-600">Professional Poultry Wholesale Management System</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="text-right mr-4">
                        <div class="text-sm font-semibold text-gray-800">ç®¡ç†å“¡</div>
                        <div class="text-xs text-gray-500">${new Date().toLocaleDateString('zh-TW')}</div>
                    </div>
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                        A
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- å´é‚Šå°èˆª -->
    <div class="flex">
        <nav class="w-64 glass-effect border-r border-white/20 min-h-screen p-6 no-print">
            <div class="space-y-2">
                <button onclick="showModule('excel')" id="excelBtn" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-medium transition-all">
                    <span class="text-xl">ğŸ“Š</span>
                    <span>Excelè¡¨æ ¼ç®¡ç†</span>
                </button>
                <button onclick="showModule('dashboard')" id="dashboardBtn" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-white/50 font-medium transition-all">
                    <span class="text-xl">ğŸ“ˆ</span>
                    <span>ç‡Ÿé‹å„€è¡¨æ¿</span>
                </button>
                <button onclick="showModule('procurement')" id="procurementBtn" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-white/50 font-medium transition-all">
                    <span class="text-xl">ğŸ“¦</span>
                    <span>æ¡è³¼é€²è²¨ç®¡ç†</span>
                </button>
                <button onclick="showModule('finance')" id="financeBtn" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-white/50 font-medium transition-all">
                    <span class="text-xl">ğŸ’°</span>
                    <span>è²¡å‹™æœƒè¨ˆç®¡ç†</span>
                </button>
                <button onclick="showModule('customer')" id="customerBtn" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-white/50 font-medium transition-all">
                    <span class="text-xl">ğŸ‘¥</span>
                    <span>å®¢æˆ¶æ¥­å‹™ç®¡ç†</span>
                </button>
                <button onclick="showModule('reports')" id="reportsBtn" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-white/50 font-medium transition-all">
                    <span class="text-xl">ğŸ“‹</span>
                    <span>å ±è¡¨åˆ†æä¸­å¿ƒ</span>
                </button>
            </div>
        </nav>

        <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
        <main class="flex-1 p-6">
            <!-- Excelè¡¨æ ¼ç®¡ç† -->
            <div id="excelModule" class="slide-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Excelè¡¨æ ¼ç®¡ç†</h2>
                    <p class="text-gray-600">åƒExcelä¸€æ¨£ç·¨è¼¯å’Œç®¡ç†æ‚¨çš„æ¥­å‹™æ•¸æ“š</p>
                </div>

                <!-- è¡¨æ ¼é¸æ“‡å™¨ -->
                <div class="mb-6">
                    <div class="flex flex-wrap gap-2">
                        <button onclick="showExcelTable('customers')" id="customersTabBtn" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all font-semibold">ğŸ‘¥ å®¢æˆ¶è³‡æ–™è¡¨</button>
                        <button onclick="showExcelTable('orders')" id="ordersTabBtn" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold">ğŸ“‹ è¨‚å–®è¨˜éŒ„è¡¨</button>
                        <button onclick="showExcelTable('inventory')" id="inventoryTabBtn" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold">ğŸ“¦ åº«å­˜ç®¡ç†è¡¨</button>
                        <button onclick="showExcelTable('finance')" id="financeTabBtn" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold">ğŸ’° è²¡å‹™è¨˜éŒ„è¡¨</button>
                        <button onclick="showExcelTable('suppliers')" id="suppliersTabBtn" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold">ğŸ­ ä¾›æ‡‰å•†è¡¨</button>
                    </div>
                </div>

                <!-- Excelè¡¨æ ¼å®¹å™¨ -->
                <div class="glass-effect rounded-2xl p-6 border border-white/20">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="excelTableTitle" class="text-xl font-semibold text-gray-800">ğŸ‘¥ å®¢æˆ¶è³‡æ–™è¡¨</h3>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="addExcelRow()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm">â• æ–°å¢è¡Œ</button>
                            <button onclick="deleteSelectedRows()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm">ğŸ—‘ï¸ åˆªé™¤é¸ä¸­</button>
                            <button onclick="duplicateRow()" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors text-sm">ğŸ“‹ è¤‡è£½è¡Œ</button>
                            <button onclick="sortTable()" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm">ğŸ”„ æ’åº</button>
                            <button onclick="exportToCSV()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm">ğŸ“¤ åŒ¯å‡ºCSV</button>
                            <button onclick="printExcelTable()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-sm">ğŸ–¨ï¸ åˆ—å°</button>
                        </div>
                    </div>
                    
                    <!-- æœå°‹å’Œç¯©é¸ -->
                    <div class="mb-4 flex gap-4">
                        <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onkeyup="searchTable()">
                        <select id="filterColumn" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" onchange="filterTable()">
                            <option value="">ç¯©é¸æ¬„ä½...</option>
                        </select>
                        <button onclick="clearFilters()" class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors text-sm">æ¸…é™¤ç¯©é¸</button>
                    </div>
                    
                    <!-- Excelé¢¨æ ¼è¡¨æ ¼ -->
                    <div class="overflow-auto max-h-96 border border-gray-300 rounded-lg">
                        <table id="excelTable" class="excel-table w-full text-sm">
                            <thead id="excelTableHead" class="sticky top-0">
                                <!-- å‹•æ…‹ç”Ÿæˆè¡¨é ­ -->
                            </thead>
                            <tbody id="excelTableBody">
                                <!-- å‹•æ…‹ç”Ÿæˆè¡¨æ ¼å…§å®¹ -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- è¡¨æ ¼çµ±è¨ˆ -->
                    <div class="mt-4 flex justify-between items-center text-sm text-gray-600">
                        <div id="tableStats">ç¸½è¨ˆ: 0 ç­†è¨˜éŒ„</div>
                        <div class="flex space-x-4">
                            <span>é¸ä¸­: <span id="selectedCount">0</span> è¡Œ</span>
                            <span>æ•¸å€¼ç¸½å’Œ: $<span id="sumValue">0</span></span>
                            <span>å¹³å‡å€¼: $<span id="avgValue">0</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç‡Ÿé‹å„€è¡¨æ¿ -->
            <div id="dashboardModule" class="hidden slide-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">ç‡Ÿé‹å„€è¡¨æ¿</h2>
                    <p class="text-gray-600">å³æ™‚ç›£æ§æ¥­å‹™ç‹€æ³èˆ‡é—œéµæŒ‡æ¨™</p>
                </div>
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ğŸ“Š</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">å„€è¡¨æ¿åŠŸèƒ½</h3>
                    <p class="text-gray-600">åŸºæ–¼Excelè¡¨æ ¼æ•¸æ“šçš„å³æ™‚çµ±è¨ˆåˆ†æ</p>
                </div>
            </div>

            <!-- å…¶ä»–æ¨¡çµ„ä½”ä½ -->
            <div id="procurementModule" class="hidden slide-in">
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ğŸ“¦</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">æ¡è³¼é€²è²¨ç®¡ç†</h3>
                    <p class="text-gray-600">ä½¿ç”¨Excelè¡¨æ ¼ç®¡ç†æ¡è³¼å’Œåº«å­˜</p>
                </div>
            </div>

            <div id="financeModule" class="hidden slide-in">
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ğŸ’°</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">è²¡å‹™æœƒè¨ˆç®¡ç†</h3>
                    <p class="text-gray-600">ä½¿ç”¨Excelè¡¨æ ¼ç®¡ç†è²¡å‹™è¨˜éŒ„</p>
                </div>
            </div>

            <div id="customerModule" class="hidden slide-in">
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ğŸ‘¥</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">å®¢æˆ¶æ¥­å‹™ç®¡ç†</h3>
                    <p class="text-gray-600">ä½¿ç”¨Excelè¡¨æ ¼ç®¡ç†å®¢æˆ¶è³‡æ–™</p>
                </div>
            </div>

            <div id="reportsModule" class="hidden slide-in">
                <div class="text-center py-12">
                    <div class="text-6xl mb-4">ğŸ“‹</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">å ±è¡¨åˆ†æä¸­å¿ƒ</h3>
                    <p class="text-gray-600">åŸºæ–¼Excelæ•¸æ“šç”Ÿæˆåˆ†æå ±è¡¨</p>
                </div>
            </div>
        </main>
    </div>

    <!-- åˆ—å°å€åŸŸ -->
    <div id="printArea" class="print-content hidden">
        <div class="print-only p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold">å„ªé®®é›è‚‰æ‰¹ç™¼</h1>
                <p class="text-lg text-gray-600">Professional Poultry Wholesale</p>
                <p class="text-sm text-gray-500">åœ°å€ï¼šå°åŒ—å¸‚ä¸­å±±å€æ°‘ç”Ÿæ±è·¯456è™Ÿ | é›»è©±ï¼š02-2345-6789</p>
                <hr class="my-4">
            </div>
            <div id="printContent"></div>
            <div class="mt-8 text-center text-sm text-gray-500">
                <p>åˆ—å°æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}</p>
            </div>
        </div>
    </div>

    <!-- éš±è—çš„æª”æ¡ˆè¼¸å…¥ -->
    <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="handleCSVImport(event)">

    <script>
        // å…¨åŸŸè³‡æ–™å„²å­˜
        let excelData = {
            customers: [],
            orders: [],
            inventory: [],
            finance: [],
            suppliers: []
        };

        // ç•¶å‰é¸ä¸­çš„è¡¨æ ¼å’Œè¡Œ
        let currentTable = 'customers';
        let selectedRows = new Set();
        let selectedCells = new Set();

        // è¡¨æ ¼çµæ§‹å®šç¾©
        const tableStructures = {
            customers: {
                title: 'ğŸ‘¥ å®¢æˆ¶è³‡æ–™è¡¨',
                columns: [
                    { key: 'name', title: 'å®¢æˆ¶åç¨±', type: 'text' },
                    { key: 'contact', title: 'è¯çµ¡äºº', type: 'text' },
                    { key: 'phone', title: 'é›»è©±', type: 'tel' },
                    { key: 'email', title: 'é›»å­éƒµä»¶', type: 'email' },
                    { key: 'address', title: 'åœ°å€', type: 'text' },
                    { key: 'type', title: 'å®¢æˆ¶é¡å‹', type: 'select', options: ['é¤å»³', 'é›è‚‰æ”¤', 'è¶…å¸‚', 'ä¾¿ç•¶åº—', 'å…¶ä»–'] },
                    { key: 'grade', title: 'å®¢æˆ¶ç­‰ç´š', type: 'select', options: ['é‘½çŸ³ç´š', 'ç™½é‡‘ç´š', 'é»ƒé‡‘ç´š', 'éŠ€ç´š', 'éŠ…ç´š'] },
                    { key: 'paymentTerms', title: 'ä»˜æ¬¾æ¢ä»¶', type: 'select', options: ['ç¾é‡‘', 'æœˆçµ15å¤©', 'æœˆçµ30å¤©', 'æœˆçµ45å¤©'] },
                    { key: 'monthlyAmount', title: 'æœˆè³¼é‡‘é¡', type: 'number' },
                    { key: 'status', title: 'ç‹€æ…‹', type: 'select', options: ['æ´»èº', 'æš«åœ', 'å¾…è¯ç¹«'] },
                    { key: 'notes', title: 'å‚™è¨»', type: 'text' }
                ]
            },
            orders: {
                title: 'ğŸ“‹ è¨‚å–®è¨˜éŒ„è¡¨',
                columns: [
                    { key: 'orderNumber', title: 'è¨‚å–®ç·¨è™Ÿ', type: 'text' },
                    { key: 'date', title: 'è¨‚å–®æ—¥æœŸ', type: 'date' },
                    { key: 'customer', title: 'å®¢æˆ¶åç¨±', type: 'text' },
                    { key: 'product', title: 'å•†å“åç¨±', type: 'text' },
                    { key: 'quantity', title: 'æ•¸é‡(kg)', type: 'number' },
                    { key: 'unitPrice', title: 'å–®åƒ¹', type: 'number' },
                    { key: 'totalAmount', title: 'ç¸½é‡‘é¡', type: 'number' },
                    { key: 'deliveryDate', title: 'äº¤è²¨æ—¥æœŸ', type: 'date' },
                    { key: 'status', title: 'è¨‚å–®ç‹€æ…‹', type: 'select', options: ['å¾…è™•ç†', 'è™•ç†ä¸­', 'å·²å‡ºè²¨', 'å·²å®Œæˆ', 'å·²å–æ¶ˆ'] },
                    { key: 'paymentStatus', title: 'ä»˜æ¬¾ç‹€æ…‹', type: 'select', options: ['æœªä»˜æ¬¾', 'éƒ¨åˆ†ä»˜æ¬¾', 'å·²ä»˜æ¬¾'] },
                    { key: 'notes', title: 'å‚™è¨»', type: 'text' }
                ]
            },
            inventory: {
                title: 'ğŸ“¦ åº«å­˜ç®¡ç†è¡¨',
                columns: [
                    { key: 'productCode', title: 'å•†å“ç·¨è™Ÿ', type: 'text' },
                    { key: 'productName', title: 'å•†å“åç¨±', type: 'text' },
                    { key: 'category', title: 'å•†å“é¡åˆ¥', type: 'select', options: ['é›èƒ¸è‚‰', 'é›è…¿è‚‰', 'å…¨é›', 'é›ç¿…', 'é›è…³', 'å…§è‡Ÿ'] },
                    { key: 'supplier', title: 'ä¾›æ‡‰å•†', type: 'text' },
                    { key: 'currentStock', title: 'ç¾æœ‰åº«å­˜(kg)', type: 'number' },
                    { key: 'safetyStock', title: 'å®‰å…¨åº«å­˜(kg)', type: 'number' },
                    { key: 'unitCost', title: 'é€²è²¨æˆæœ¬', type: 'number' },
                    { key: 'sellingPrice', title: 'éŠ·å”®åƒ¹æ ¼', type: 'number' },
                    { key: 'expiryDate', title: 'ä¿å­˜æœŸé™', type: 'date' },
                    { key: 'location', title: 'å­˜æ”¾ä½ç½®', type: 'text' },
                    { key: 'status', title: 'åº«å­˜ç‹€æ…‹', type: 'select', options: ['å……è¶³', 'åä½', 'ä¸è¶³', 'éæœŸ'] }
                ]
            },
            finance: {
                title: 'ğŸ’° è²¡å‹™è¨˜éŒ„è¡¨',
                columns: [
                    { key: 'date', title: 'æ—¥æœŸ', type: 'date' },
                    { key: 'type', title: 'é¡å‹', type: 'select', options: ['æ”¶å…¥', 'æ”¯å‡º'] },
                    { key: 'category', title: 'ç§‘ç›®', type: 'text' },
                    { key: 'description', title: 'èªªæ˜', type: 'text' },
                    { key: 'amount', title: 'é‡‘é¡', type: 'number' },
                    { key: 'paymentMethod', title: 'ä»˜æ¬¾æ–¹å¼', type: 'select', options: ['ç¾é‡‘', 'éŠ€è¡Œè½‰å¸³', 'æ”¯ç¥¨', 'ä¿¡ç”¨å¡'] },
                    { key: 'invoiceNumber', title: 'ç™¼ç¥¨è™Ÿç¢¼', type: 'text' },
                    { key: 'customer', title: 'å®¢æˆ¶/ä¾›æ‡‰å•†', type: 'text' },
                    { key: 'status', title: 'ç‹€æ…‹', type: 'select', options: ['å·²ç¢ºèª', 'å¾…ç¢ºèª', 'å·²å–æ¶ˆ'] },
                    { key: 'notes', title: 'å‚™è¨»', type: 'text' }
                ]
            },
            suppliers: {
                title: 'ğŸ­ ä¾›æ‡‰å•†è¡¨',
                columns: [
                    { key: 'name', title: 'ä¾›æ‡‰å•†åç¨±', type: 'text' },
                    { key: 'contact', title: 'è¯çµ¡äºº', type: 'text' },
                    { key: 'phone', title: 'é›»è©±', type: 'tel' },
                    { key: 'email', title: 'é›»å­éƒµä»¶', type: 'email' },
                    { key: 'address', title: 'åœ°å€', type: 'text' },
                    { key: 'products', title: 'ä¸»è¦å•†å“', type: 'text' },
                    { key: 'paymentTerms', title: 'ä»˜æ¬¾æ¢ä»¶', type: 'select', options: ['ç¾é‡‘', 'æœˆçµ15å¤©', 'æœˆçµ30å¤©', 'æœˆçµ45å¤©'] },
                    { key: 'rating', title: 'è©•ç­‰', type: 'select', options: ['å„ªè‰¯', 'è‰¯å¥½', 'æ™®é€š', 'å¾…æ”¹å–„'] },
                    { key: 'monthlyAmount', title: 'æœˆæ¡è³¼é¡', type: 'number' },
                    { key: 'status', title: 'ç‹€æ…‹', type: 'select', options: ['åˆä½œä¸­', 'æš«åœ', 'è©•ä¼°ä¸­'] },
                    { key: 'notes', title: 'å‚™è¨»', type: 'text' }
                ]
            }
        };

        // æ¨¡çµ„åˆ‡æ›åŠŸèƒ½
        function showModule(moduleName) {
            const modules = ['excel', 'dashboard', 'procurement', 'finance', 'customer', 'reports'];
            modules.forEach(module => {
                const moduleElement = document.getElementById(module + 'Module');
                const btnElement = document.getElementById(module + 'Btn');
                if (moduleElement) moduleElement.classList.add('hidden');
                if (btnElement) btnElement.className = 'w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-700 hover:bg-white/50 font-medium transition-all';
            });
            
            const targetModule = document.getElementById(moduleName + 'Module');
            const targetBtn = document.getElementById(moduleName + 'Btn');
            if (targetModule) targetModule.classList.remove('hidden');
            if (targetBtn) targetBtn.className = 'w-full flex items-center space-x-3 px-4 py-3 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-medium transition-all';
        }

        // Excelè¡¨æ ¼åŠŸèƒ½
        function showExcelTable(tableName) {
            currentTable = tableName;
            selectedRows.clear();
            selectedCells.clear();
            
            // æ›´æ–°æ¨™ç±¤æŒ‰éˆ•æ¨£å¼
            const tabButtons = ['customersTabBtn', 'ordersTabBtn', 'inventoryTabBtn', 'financeTabBtn', 'suppliersTabBtn'];
            tabButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.className = 'px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all font-semibold';
                }
            });
            
            const activeBtn = document.getElementById(tableName + 'TabBtn');
            if (activeBtn) {
                activeBtn.className = 'px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all font-semibold';
            }
            
            // æ›´æ–°è¡¨æ ¼æ¨™é¡Œ
            document.getElementById('excelTableTitle').textContent = tableStructures[tableName].title;
            
            // æ›´æ–°ç¯©é¸é¸é …
            updateFilterOptions();
            
            // æ¸²æŸ“è¡¨æ ¼
            renderExcelTable();
            updateTableStats();
        }

        function renderExcelTable() {
            const structure = tableStructures[currentTable];
            const data = excelData[currentTable];
            
            // æ¸²æŸ“è¡¨é ­
            const thead = document.getElementById('excelTableHead');
            thead.innerHTML = `
                <tr>
                    <th class="row-number">#</th>
                    ${structure.columns.map((col, index) => `
                        <th class="column-header" onclick="sortByColumn(${index})" title="é»æ“Šæ’åº">
                            ${col.title}
                            <span class="text-xs text-gray-400 ml-1">â†•ï¸</span>
                        </th>
                    `).join('')}
                </tr>
            `;
            
            // æ¸²æŸ“è¡¨æ ¼å…§å®¹
            const tbody = document.getElementById('excelTableBody');
            if (data.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="${structure.columns.length + 1}" class="text-center py-8 text-gray-500">
                            <div class="text-2xl mb-2">ğŸ“</div>
                            <div>å°šç„¡è³‡æ–™ï¼Œé»æ“Šã€Œæ–°å¢è¡Œã€é–‹å§‹å»ºç«‹</div>
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = data.map((row, rowIndex) => `
                    <tr class="${selectedRows.has(rowIndex) ? 'selected' : ''}" onclick="selectRow(${rowIndex}, event)">
                        <td class="row-number">${rowIndex + 1}</td>
                        ${structure.columns.map((col, colIndex) => `
                            <td class="${selectedCells.has(`${rowIndex}-${colIndex}`) ? 'selected' : ''}" 
                                onclick="selectCell(${rowIndex}, ${colIndex}, event)">
                                ${renderCell(row[col.key] || '', col, rowIndex, colIndex)}
                            </td>
                        `).join('')}
                    </tr>
                `).join('');
            }
        }

        function renderCell(value, column, rowIndex, colIndex) {
            if (column.type === 'select') {
                return `
                    <select class="excel-input" onchange="updateCellValue(${rowIndex}, '${column.key}', this.value)">
                        <option value="">${value || 'è«‹é¸æ“‡...'}</option>
                        ${column.options.map(option => `
                            <option value="${option}" ${value === option ? 'selected' : ''}>${option}</option>
                        `).join('')}
                    </select>
                `;
            } else {
                return `
                    <input type="${column.type}" 
                           class="excel-input" 
                           value="${value || ''}" 
                           onchange="updateCellValue(${rowIndex}, '${column.key}', this.value)"
                           ${column.type === 'number' ? 'step="0.01"' : ''}
                           placeholder="è¼¸å…¥${column.title}...">
                `;
            }
        }

        function updateCellValue(rowIndex, key, value) {
            if (!excelData[currentTable][rowIndex]) {
                excelData[currentTable][rowIndex] = {};
            }
            excelData[currentTable][rowIndex][key] = value;
            
            // å¦‚æœæ˜¯è¨‚å–®è¡¨æ ¼ï¼Œè‡ªå‹•è¨ˆç®—ç¸½é‡‘é¡
            if (currentTable === 'orders' && (key === 'quantity' || key === 'unitPrice')) {
                const row = excelData[currentTable][rowIndex];
                if (row.quantity && row.unitPrice) {
                    row.totalAmount = (parseFloat(row.quantity) * parseFloat(row.unitPrice)).toFixed(2);
                    renderExcelTable(); // é‡æ–°æ¸²æŸ“ä»¥é¡¯ç¤ºè¨ˆç®—çµæœ
                }
            }
            
            updateTableStats();
            showNotification('è³‡æ–™å·²æ›´æ–°', 'success');
        }

        function selectRow(rowIndex, event) {
            event.stopPropagation();
            
            if (event.ctrlKey || event.metaKey) {
                // å¤šé¸æ¨¡å¼
                if (selectedRows.has(rowIndex)) {
                    selectedRows.delete(rowIndex);
                } else {
                    selectedRows.add(rowIndex);
                }
            } else {
                // å–®é¸æ¨¡å¼
                selectedRows.clear();
                selectedRows.add(rowIndex);
            }
            
            renderExcelTable();
            updateTableStats();
        }

        function selectCell(rowIndex, colIndex, event) {
            event.stopPropagation();
            
            const cellKey = `${rowIndex}-${colIndex}`;
            if (event.ctrlKey || event.metaKey) {
                if (selectedCells.has(cellKey)) {
                    selectedCells.delete(cellKey);
                } else {
                    selectedCells.add(cellKey);
                }
            } else {
                selectedCells.clear();
                selectedCells.add(cellKey);
            }
            
            renderExcelTable();
        }

        function addExcelRow() {
            const structure = tableStructures[currentTable];
            const newRow = {};
            
            // åˆå§‹åŒ–æ–°è¡Œçš„é è¨­å€¼
            structure.columns.forEach(col => {
                if (col.key === 'date' || col.key === 'orderDate') {
                    newRow[col.key] = new Date().toISOString().split('T')[0];
                } else if (col.key === 'orderNumber') {
                    newRow[col.key] = 'ORD-' + new Date().getFullYear() + '-' + String(Date.now()).slice(-6);
                } else if (col.key === 'productCode') {
                    newRow[col.key] = 'PRD-' + String(Date.now()).slice(-6);
                } else {
                    newRow[col.key] = '';
                }
            });
            
            excelData[currentTable].push(newRow);
            renderExcelTable();
            updateTableStats();
            showNotification('å·²æ–°å¢ä¸€è¡Œ', 'success');
        }

        function deleteSelectedRows() {
            if (selectedRows.size === 0) {
                showNotification('è«‹å…ˆé¸æ“‡è¦åˆªé™¤çš„è¡Œ', 'error');
                return;
            }
            
            if (confirm(`ç¢ºå®šè¦åˆªé™¤é¸ä¸­çš„ ${selectedRows.size} è¡Œå—ï¼Ÿ`)) {
                const sortedRows = Array.from(selectedRows).sort((a, b) => b - a);
                sortedRows.forEach(rowIndex => {
                    excelData[currentTable].splice(rowIndex, 1);
                });
                
                selectedRows.clear();
                selectedCells.clear();
                renderExcelTable();
                updateTableStats();
                showNotification(`å·²åˆªé™¤ ${sortedRows.length} è¡Œ`, 'success');
            }
        }

        function duplicateRow() {
            if (selectedRows.size !== 1) {
                showNotification('è«‹é¸æ“‡ä¸€è¡Œé€²è¡Œè¤‡è£½', 'error');
                return;
            }
            
            const rowIndex = Array.from(selectedRows)[0];
            const originalRow = excelData[currentTable][rowIndex];
            const duplicatedRow = { ...originalRow };
            
            // æ›´æ–°ç‰¹æ®Šæ¬„ä½
            if (duplicatedRow.orderNumber) {
                duplicatedRow.orderNumber = 'ORD-' + new Date().getFullYear() + '-' + String(Date.now()).slice(-6);
            }
            if (duplicatedRow.productCode) {
                duplicatedRow.productCode = 'PRD-' + String(Date.now()).slice(-6);
            }
            
            excelData[currentTable].splice(rowIndex + 1, 0, duplicatedRow);
            renderExcelTable();
            updateTableStats();
            showNotification('å·²è¤‡è£½è¡Œ', 'success');
        }

        function sortByColumn(columnIndex) {
            const structure = tableStructures[currentTable];
            const column = structure.columns[columnIndex];
            const data = excelData[currentTable];
            
            data.sort((a, b) => {
                const aVal = a[column.key] || '';
                const bVal = b[column.key] || '';
                
                if (column.type === 'number') {
                    return parseFloat(aVal) - parseFloat(bVal);
                } else if (column.type === 'date') {
                    return new Date(aVal) - new Date(bVal);
                } else {
                    return aVal.toString().localeCompare(bVal.toString());
                }
            });
            
            renderExcelTable();
            showNotification(`å·²æŒ‰ ${column.title} æ’åº`, 'success');
        }

        function searchTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#excelTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function updateFilterOptions() {
            const structure = tableStructures[currentTable];
            const filterSelect = document.getElementById('filterColumn');
            
            filterSelect.innerHTML = `
                <option value="">ç¯©é¸æ¬„ä½...</option>
                ${structure.columns.map(col => `
                    <option value="${col.key}">${col.title}</option>
                `).join('')}
            `;
        }

        function filterTable() {
            const filterColumn = document.getElementById('filterColumn').value;
            if (!filterColumn) return;
            
            const uniqueValues = [...new Set(excelData[currentTable].map(row => row[filterColumn]).filter(val => val))];
            
            if (uniqueValues.length === 0) {
                showNotification('è©²æ¬„ä½æ²’æœ‰è³‡æ–™å¯ç¯©é¸', 'error');
                return;
            }
            
            const selectedValue = prompt(`é¸æ“‡ç¯©é¸å€¼ï¼š\n${uniqueValues.join('\n')}`);
            if (selectedValue) {
                const rows = document.querySelectorAll('#excelTableBody tr');
                rows.forEach((row, index) => {
                    if (index === 0 && row.cells.length === 1) return; // è·³éç©ºç‹€æ…‹è¡Œ
                    
                    const rowData = excelData[currentTable][index];
                    if (rowData && rowData[filterColumn] === selectedValue) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterColumn').value = '';
            const rows = document.querySelectorAll('#excelTableBody tr');
            rows.forEach(row => {
                row.style.display = '';
            });
            showNotification('å·²æ¸…é™¤æ‰€æœ‰ç¯©é¸', 'success');
        }

        function updateTableStats() {
            const data = excelData[currentTable];
            const structure = tableStructures[currentTable];
            
            // æ›´æ–°åŸºæœ¬çµ±è¨ˆ
            document.getElementById('tableStats').textContent = `ç¸½è¨ˆ: ${data.length} ç­†è¨˜éŒ„`;
            document.getElementById('selectedCount').textContent = selectedRows.size;
            
            // è¨ˆç®—æ•¸å€¼æ¬„ä½çš„ç¸½å’Œå’Œå¹³å‡å€¼
            const numberColumns = structure.columns.filter(col => col.type === 'number');
            let totalSum = 0;
            let count = 0;
            
            data.forEach(row => {
                numberColumns.forEach(col => {
                    const value = parseFloat(row[col.key]);
                    if (!isNaN(value)) {
                        totalSum += value;
                        count++;
                    }
                });
            });
            
            document.getElementById('sumValue').textContent = totalSum.toLocaleString();
            document.getElementById('avgValue').textContent = count > 0 ? (totalSum / count).toFixed(2) : '0';
        }

        function exportToCSV() {
            const structure = tableStructures[currentTable];
            const data = excelData[currentTable];
            
            if (data.length === 0) {
                showNotification('æ²’æœ‰è³‡æ–™å¯åŒ¯å‡º', 'error');
                return;
            }
            
            // å»ºç«‹CSVå…§å®¹
            const headers = structure.columns.map(col => col.title).join(',');
            const rows = data.map(row => 
                structure.columns.map(col => {
                    const value = row[col.key] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                }).join(',')
            );
            
            const csvContent = [headers, ...rows].join('\n');
            
            // ä¸‹è¼‰æª”æ¡ˆ
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${currentTable}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('CSVæª”æ¡ˆå·²åŒ¯å‡º', 'success');
        }

        function importFromCSV() {
            document.getElementById('csvFileInput').click();
        }

        function handleCSVImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n').filter(line => line.trim());
                    
                    if (lines.length < 2) {
                        showNotification('CSVæª”æ¡ˆæ ¼å¼ä¸æ­£ç¢º', 'error');
                        return;
                    }
                    
                    const structure = tableStructures[currentTable];
                    const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                    
                    const importedData = [];
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                        const row = {};
                        
                        structure.columns.forEach((col, index) => {
                            if (index < values.length) {
                                row[col.key] = values[index];
                            }
                        });
                        
                        importedData.push(row);
                    }
                    
                    if (confirm(`å°‡åŒ¯å…¥ ${importedData.length} ç­†è³‡æ–™ï¼Œæ˜¯å¦ç¹¼çºŒï¼Ÿ`)) {
                        excelData[currentTable] = [...excelData[currentTable], ...importedData];
                        renderExcelTable();
                        updateTableStats();
                        showNotification(`å·²åŒ¯å…¥ ${importedData.length} ç­†è³‡æ–™`, 'success');
                    }
                } catch (error) {
                    showNotification('CSVæª”æ¡ˆè§£æå¤±æ•—', 'error');
                }
            };
            
            reader.readAsText(file, 'UTF-8');
            event.target.value = ''; // æ¸…é™¤æª”æ¡ˆé¸æ“‡
        }

        function printExcelTable() {
            const structure = tableStructures[currentTable];
            const data = excelData[currentTable];
            
            let tableHTML = `
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            ${structure.columns.map(col => `<th class="border border-gray-300 p-2 text-left">${col.title}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(row => `
                            <tr>
                                ${structure.columns.map(col => `<td class="border border-gray-300 p-2">${row[col.key] || ''}</td>`).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('printContent').innerHTML = `
                <h2 class="text-2xl font-bold mb-4">${structure.title}</h2>
                <p class="mb-4">åˆ—å°æ—¥æœŸï¼š${new Date().toLocaleDateString('zh-TW')} | ç¸½è¨ˆï¼š${data.length} ç­†è¨˜éŒ„</p>
                ${tableHTML}
            `;
            
            document.getElementById('printArea').classList.remove('hidden');
            window.print();
            document.getElementById('printArea').classList.add('hidden');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-xl shadow-lg z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white max-w-sm bounce-in`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">${type === 'success' ? 'âœ…' : 'âŒ'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'n':
                        e.preventDefault();
                        addExcelRow();
                        break;
                    case 'd':
                        e.preventDefault();
                        duplicateRow();
                        break;
                    case 'Delete':
                        e.preventDefault();
                        deleteSelectedRows();
                        break;
                    case 's':
                        e.preventDefault();
                        exportToCSV();
                        break;
                }
            }
        });

        // é é¢è¼‰å…¥åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showExcelTable('customers');
            
            // æ·»åŠ ä¸€äº›ç¯„ä¾‹è³‡æ–™
            excelData.customers = [
                {
                    name: 'ç¯„ä¾‹å®¢æˆ¶',
                    contact: 'å¼µå…ˆç”Ÿ',
                    phone: '02-1234-5678',
                    email: 'example@email.com',
                    address: 'å°åŒ—å¸‚ä¸­å±±å€',
                    type: 'é¤å»³',
                    grade: 'é»ƒé‡‘ç´š',
                    paymentTerms: 'æœˆçµ30å¤©',
                    monthlyAmount: '50000',
                    status: 'æ´»èº',
                    notes: 'å„ªè³ªå®¢æˆ¶'
                }
            ];
            
            renderExcelTable();
            updateTableStats();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'975c3a1701834a1b',t:'MTc1NjMwNDYwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
