<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUMASONIX 專業技術支援 - 請款單</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f5f5;
        }
        
        .page {
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            page-break-after: always;
        }
        
        .header {
            background-color: #000000;
        }
        
        .footer {
            background-color: #f8f9fa;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            vertical-align: middle;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .btn {
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        input, textarea, select {
            border: 1px solid #e2e8f0;
            border-radius: 0.25rem;
            padding: 0.5rem;
            width: 100%;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3a7bd5;
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.1);
        }
        
        .checkbox-cell {
            text-align: center;
        }
        
        /* 數字輸入框樣式 */
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* 步進器樣式 */
        .stepper {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stepper-input {
            width: 60px;
            text-align: center;
        }
        
        .stepper-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e2e8f0;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
        }
        
        .stepper-btn:hover {
            background-color: #cbd5e0;
        }
        
        /* 複合欄位樣式 */
        .combined-field {
            display: flex;
            flex-direction: column;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .number-input-small {
            width: 60px;
            text-align: center;
        }
        
        /* 雙行表頭樣式 */
        .double-header th {
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .double-header th.subheader {
            font-weight: normal;
            font-size: 0.875rem;
            border-top: none;
        }
        
        /* 活動表格樣式 */
        .activity-table td {
            border: 1px solid #e2e8f0;
            padding: 0.5rem;
        }
        
        .activity-table input[type="text"],
        .activity-table input[type="number"] {
            border: none;
            background: transparent;
            width: 100%;
            padding: 0.25rem;
        }
        
        .activity-table input:focus {
            outline: none;
            background-color: #f0f9ff;
        }
        
        .special-work-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .special-work-cell input[type="number"] {
            width: 40px;
            text-align: center;
            margin-bottom: 4px;
        }
        
        .special-work-checkboxes {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .special-work-checkboxes label {
            display: flex;
            align-items: center;
            margin: 0;
            font-size: 0.75rem;
        }
        
        .special-work-checkboxes input[type="checkbox"] {
            width: auto;
            margin-right: 2px;
        }
        
        .tabular-nums {
            font-variant-numeric: tabular-nums;
        }
        
        /* 備註區塊樣式 */
        .notes-section {
            background-color: #f9f9f9;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .section-header {
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .notes-content ul {
            padding-left: 1.5rem;
            margin: 0;
        }
        
        .notes-content li {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }
        
        /* 操作欄位不換行 */
        .nowrap {
            white-space: nowrap;
        }
        
        @media print {
            .page {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white;
            }
            
            .page {
                page-break-after: always;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 控制按鈕 - 只在螢幕上顯示 -->
    <div class="fixed top-4 right-4 flex gap-2 no-print z-50">
        <button onclick="showPage(1)" class="btn bg-blue-600 text-white px-4 py-2 rounded-lg">第一頁</button>
        <button onclick="showPage(2)" class="btn bg-blue-600 text-white px-4 py-2 rounded-lg">第二頁</button>
        <button onclick="showPage(3)" class="btn bg-blue-600 text-white px-4 py-2 rounded-lg">第三頁</button>
        <button onclick="window.print()" class="btn bg-green-600 text-white px-4 py-2 rounded-lg">列印請款單</button>
        <button onclick="downloadPDF()" class="btn bg-purple-600 text-white px-4 py-2 rounded-lg">下載 PDF</button>
        <button onclick="resetForm()" class="btn bg-yellow-600 text-white px-4 py-2 rounded-lg">重製表單</button>
    </div>

    <!-- 第一頁：費用明細 -->
    <div id="page1" class="page max-w-4xl mx-auto my-8 p-8 rounded-lg">
        <!-- 頁首 -->
        <div class="header text-white p-6 rounded-t-lg">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold">LUMASONIX x PROFESSIONAL</h1>
                    <p class="text-3xl">專業技術支援 x 人力媒合行銷</p>
                </div>
                <div>
                    <p class="text-3xl font-bold">技術人員請款單</p>
                </div>
            </div>
        </div>
        
        <!-- 客戶資訊 -->
        <div class="bg-gray-100 p-6 border-b border-gray-300">
           <div class="grid grid-cols-3 gap-4">
                <div>
                    <p class="mb-1"><strong>請款編號</strong></p>
                    <input type="text" id="invoiceNumber" value="LX-" class="w-full">
                </div>
                <div>
                    <p class="mb-1"><strong>負責人</strong></p>
                    <input type="text" id="responsiblePerson" value="蘇裕庭" class="w-full">
                </div>
                <div>
                    <p class="mb-1"><strong>連絡電話</strong></p>
                    <input type="text" id="contactPhone" value="0926169899" class="w-full">
                </div>
            </div>
            <div class="grid grid-cols-3 gap-4 mt-4">
                <div>
                    <p class="mb-1"><strong>請款日期</strong></p>
                    <input type="date" id="invoiceDate" value="2025-06-01" class="w-full">
                </div>
                <div>
                    <p class="mb-1"><strong>請款月份</strong></p>
                    <input type="text" id="invoiceMonth" value="2025年06月" class="w-full">
                </div>
                <div>
                    <p class="mb-1"><strong>廠商名稱</strong></p>
                   <input type="text" id="vendorName" placeholder="請輸入廠商名稱" class="w-full">


                </div>
            </div>
        </div>
        
        <!-- 費用明細 -->
        <div class="p-6">
            <h2 class="text-2xl font-bold mb-4">費用統計</h2>
            <table class="w-full mb-6">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="w-1/4">項目</th>
                        <th class="w-1/12 text-center">數量</th>
                        <th class="w-1/12 text-center">單價</th>
                        <th>描述項目</th>
                        <th class="w-1/8 text-center">金額</th>
                        <th class="w-16 text-center nowrap">操作</th>
                    </tr>
                </thead>
                <tbody id="feeTable">
                    <tr id="personnelSupportRow">
                        <td>人事支援</td>
                        <td><input type="number" id="personnelQty" value="1" class="w-full text-center" onchange="calculateFees()"></td>
                        <td><input type="number" id="personnelPrice" value="2500" class="w-full text-center" onchange="calculateFees()"></td>
                        <td>進場演出撤場</td>
                        <td><input type="number" id="personnelAmount" value="2500" class="w-full text-right" readonly></td>
                        <td class="text-center nowrap">-</td>
                    </tr>
                    <tr>
                        <td>控場/追光/高空</td>
                        <td><input type="number" id="specialQty" value="0" class="w-full text-center" onchange="calculateFees()"></td>
                        <td><input type="number" id="specialPrice" value="1000" class="w-full text-center" onchange="calculateFees()"></td>
                        <td>演出前一日彩排，將視為一場演出，另行計費,彩排與演出同日進行，僅收取一次演出費用</td>
                        <td><input type="number" id="specialAmount" value="0" class="w-full text-right" readonly></td>
                        <td class="text-center nowrap">-</td>
                    </tr>
                    <tr>
                        <td>加班</td>
                        <td><input type="number" id="overtimeQty" value="0" class="w-full text-center" onchange="calculateFees()"></td>
                        <td><input type="number" id="overtimePrice" value="350" class="w-full text-center" onchange="calculateFees()"></td>
                        <td>當月總計加班時數</td>
                        <td><input type="number" id="overtimeAmount" value="0" class="w-full text-right" readonly></td>
                        <td class="text-center nowrap">-</td>
                    </tr>
                    <tr id="adminFeeRow">
                        <td>行政執行費</td>
                        <td class="text-center">一式</td>
                        <td class="text-center">10%</td>
                        <td>當月總計人數*10%*2500</td>
                        <td><input type="number" id="adminAmount" value="250" class="w-full text-right" readonly></td>
                        <td class="text-center nowrap">-</td>
                    </tr>
                    <tr>
                        <td>其他</td>
                        <td class="text-center">一式</td>
                        <td class="text-center">-</td>
                        <td><input type="text" placeholder="描述" class="w-full"></td>
                        <td><input type="number" id="otherAmount" value="0" class="w-full text-right" onchange="calculateFees()"></td>
                        <td class="text-center nowrap">
                            <button class="text-red-500 hover:text-red-700" onclick="removeRow(this)">
                                ✕
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <!-- 新增費用按鈕 -->
            <div class="flex justify-end mb-6">
                <button id="addFeeBtn" class="btn bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center" onclick="addFeeItem()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    新增其他費用
                </button>
            </div>
            
            <!-- 費用統計和匯款資訊並排 -->
            <div class="flex justify-between items-start">
                <!-- 匯款資訊 - 左側 -->
                 <div class="bg-gray-100 p-6 rounded-lg w-1/2 mr-4">
                    <h2 class="text-3xl font-bold mb-2">【匯款資訊】</h2>
                    <h2 class="text-2xl font-bold mb-2">帳號戶名：蘇裕庭</h2> 
                    <h2 class="text-xl font-bold mb-2">匯款代碼：808(玉山中路特區分行)</h2>
                    <h2 class="text-2xl font-bold mb-2">匯款帳號：0842-979-176643</h2>
                    
                               </div>

                
                <!-- 費用統計 - 右側 -->
                <div class="bg-gray-100 p-4 rounded-lg w-80 ml-auto">
                    <!-- 小計 -->
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold">費用小計：</span>
                        <div class="flex items-center w-40 justify-end">
                            <span id="subtotal" class="font-bold tabular-nums text-right w-24">2,750</span>
                            <span class="ml-1 font-bold">元整</span>
                        </div>
                    </div>

                    <!-- 總計 -->
                    <div class="flex items-center justify-between font-bold text-2xl text-red-500">
                        <span>總計金額：</span>
                        <div class="flex items-center w-40 justify-end">
                            <span id="total" class="tabular-nums text-right w-24">2,750</span>
                            <span class="ml-1 text-base">元整</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 備註區塊 - 獨立區域 -->
            <div class="notes-section mt-6">
                <div class="section-header">備註事項</div>
                <div class="notes-content">
                    <ul>
                        <li>本人僅協助媒合與執行活動之統籌角色，執行風險與責任應由現場技術人員自負。</li>
                        <li>移動至不同活動場地即視為新場次，費用重新計算。</li>
                           <li>活動結束雙方於現場確認交付狀況後視驗收完畢，恕不再就當日服務異議減項。</li>
                        <li>維持作業品質與人員安排效率等相關行政作業，將酌收行政執行費用，已併入請款明細列示。</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 頁尾 -->
        <div class="footer mt-8 p-4 text-center text-gray-600 rounded-b-lg">
            <p>LUMASONIX x PROFESSIONAL | 專業技術支援 x 人力媒合行銷</p>
            <p>電話: 0926-169-899 | 電子郵件: lumasonix@gmail.com</p>
        </div>
    </div>

    <!-- 第二頁：活動明細 -->
    <div id="page2" class="page max-w-4xl mx-auto my-8 p-8 rounded-lg hidden">
        <!-- 頁首 -->
        <div class="header text-white p-6 rounded-t-lg">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold">LUMASONIX x PROFESSIONAL</h1>
                    <p class="text-3xl">專業技術支援 x 人力媒合行銷</p>
                </div>
                <div>
                    <p class="text-2xl font-bold">技術人員請款單</p>
                </div>
            </div>
        </div>
        
        <!-- 活動明細 -->
        <div class="p-6">
            <h2 class="text-2xl font-bold mb-4">活動支援明細</h2>
            <table class="w-full mb-6 activity-table">
                <thead class="bg-gray-200 double-header">
                    <tr>
                        <th rowspan="2">日期</th>
                        <th rowspan="2">活動地點</th>
                        <th rowspan="2">人數</th>
                        <th rowspan="2">上班<br>時間</th>
                        <th rowspan="2">下班<br>時間</th>
                        <th rowspan="2">高空控/追光</th>
                        <th rowspan="2">加班<br>時數</th>
                        <th rowspan="2">請款<br>金額</th>
                        <th rowspan="2" class="nowrap">操作</th>
                    </tr>
                </thead>
                <tbody id="activityTable">
                    <tr>
                        <td><input type="text" placeholder="MM/DD" class="activity-date"></td>
                        <td><input type="text" placeholder="活動地點" class="activity-location"></td>
                        <td><input type="number" value="1" min="1" class="activity-qty text-center" onchange="calculateActivityFees(this)"></td>
                        <td><input type="text" placeholder="HH:MM" class="activity-start-time text-center"></td>
                        <td><input type="text" placeholder="HH:MM" class="activity-end-time text-center"></td>
                        <td class="special-work-cell">
                            <input type="number" value="0" min="0" class="activity-special-qty" onchange="calculateActivityFees(this)">
                            <div class="special-work-checkboxes">
                                <label><input type="checkbox" class="activity-height"> 高</label>
                                <label><input type="checkbox" class="activity-spotlight"> 追</label>
                                <label><input type="checkbox" class="activity-control"> 控</label>
                            </div>
                        </td>
                        <td>
                            <div class="stepper">
                                <div class="stepper-btn" onclick="adjustOvertime(this, -0.5)">-</div>
                                <input type="number" value="0" step="0.5" min="0" class="stepper-input activity-overtime-hours" onchange="validateOvertime(this); calculateActivityFees(this)">
                                <div class="stepper-btn" onclick="adjustOvertime(this, 0.5)">+</div>
                            </div>
                        </td>
                        <td><input type="number" value="2500" class="activity-amount text-right" readonly></td>
                        <td class="text-center nowrap">
                            <button class="text-red-500 hover:text-red-700" onclick="removeActivityRow(this)">
                                ✕
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <!-- 新增活動按鈕 -->
            <div class="flex justify-end mb-6">
                <button id="addActivityBtn" class="btn bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center" onclick="addActivityItem()">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    新增活動
                </button>
            </div>
            
            <!-- 活動費用統計 -->
            <div class="flex justify-end">
                <div class="bg-gray-100 p-4 rounded-lg w-80">
                    <!-- 總計 -->
                    <div class="flex items-center justify-between font-bold text-2xl text-red-500">
                        <span>總計金額：</span>
                        <div class="flex items-center w-40 justify-end">
                            <span id="activityTotal" class="tabular-nums text-right w-24">2,500</span>
                            <span class="ml-1 text-base">元整</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 備註區塊 -->
            <div class="notes-section mt-6">
                <div class="section-header">備註事項</div>
                <div class="notes-content">
                    <ul>
                        <li>本人僅協助媒合與執行活動之統籌角色，執行風險與責任應由現場技術人員自負。</li>
                        <li>移動至不同活動場地即視為新場次，費用重新計算。</li>
                           <li>活動結束雙方於現場確認交付狀況後視驗收完畢，恕不再就當日服務異議減項。</li>
                        <li>維持作業品質與人員安排效率等相關行政作業，將酌收行政執行費用，已併入請款明細列示。</li>

                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 頁尾 -->
        <div class="footer mt-8 p-4 text-center text-gray-600 rounded-b-lg">
            <p>LUMASONIX x PROFESSIONAL | 專業技術支援 x 人力媒合行銷</p>
            <p>電話: 0926-169-899 | 電子郵件: lumasonix@gmail.com</p>
        </div>
    </div>

    <!-- 第三頁：活動明細續頁 -->
    <div id="page3" class="page max-w-4xl mx-auto my-8 p-8 rounded-lg hidden">
        <!-- 頁首 -->
        <div class="header text-white p-6 rounded-t-lg">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">LUMASONIX x PROFESSIONAL</h1>
                    <p class="text-lg">專業技術支援 x 人力媒合行銷</p>
                </div>
                <div>
                    <p class="text-xl font-bold">技術人員請款單 (續)</p>
                </div>
            </div>
        </div>
        
        <!-- 活動明細續頁 -->
        <div class="p-6">
            <h2 class="text-xl font-bold mb-4">活動支援明細 (續)</h2>
            <table class="w-full mb-6 activity-table">
                <thead class="bg-gray-200 double-header">
                    <tr>
                        <th rowspan="2">日期</th>
                        <th rowspan="2">活動地點</th>
                        <th rowspan="2">人數</th>
                        <th rowspan="2">上班<br>時間</th>
                        <th rowspan="2">下班<br>時間</th>
                        <th rowspan="2">高空控/追光</th>
                        <th rowspan="2">加班<br>時數</th>
                        <th rowspan="2">請款<br>金額</th>
                        <th rowspan="2" class="nowrap">操作</th>
                    </tr>
                </thead>
                <tbody id="activityTableContinued">
                    <!-- 這裡會動態添加更多活動 -->
                </tbody>
            </table>
            
            <!-- 備註區塊 -->
            <div class="notes-section mt-6">
                <div class="section-header">備註事項</div>
                <div class="notes-content">
                    <ul>
                        <li>本人僅協助媒合與執行活動之統籌角色，執行風險與責任應由現場技術人員自負。</li>
                        <li>移動至不同活動場地即視為新場次，費用重新計算。</li>
                        <li>演出當天取消需支付報價金額之 50% ，改期需於五日前通知，否則視同取消。</li>
                        <li>活動結束雙方應現場確認交付狀況後視驗收完畢，恕不再就當日服務異議減項。</li>
                        <li>維持作業品質與人員安排效率等相關行政作業，將酌收行政執行費用，已併入請款明細列示。</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 頁尾 -->
        <div class="footer mt-8 p-4 text-center text-gray-600 rounded-b-lg">
            <p>LUMASONIX x PROFESSIONAL | 專業技術支援 x 人力媒合行銷</p>
            <p>電話: 0926-169-899 | 電子郵件: lumasonix@gmail.com</p>
        </div>
    </div>

    <script>
        // 設置當前日期
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化頁面
            showPage(1);
            
            // 計算初始費用
            calculateFees();
        });
        
        // 頁面切換功能
        function showPage(pageNum) {
            document.getElementById('page1').classList.add('hidden');
            document.getElementById('page2').classList.add('hidden');
            document.getElementById('page3').classList.add('hidden');
            
            document.getElementById('page' + pageNum).classList.remove('hidden');
        }
        
        // 計算費用
        function calculateFees() {
            // 人事支援費用
            const personnelQty = parseFloat(document.getElementById('personnelQty').value) || 0;
            const personnelPrice = parseFloat(document.getElementById('personnelPrice').value) || 0;
            const personnelAmount = personnelQty * personnelPrice;
            document.getElementById('personnelAmount').value = personnelAmount;
            
            // 特殊工作費用 (控場/追光/高空)
            const specialQty = parseFloat(document.getElementById('specialQty').value) || 0;
            const specialPrice = parseFloat(document.getElementById('specialPrice').value) || 0;
            const specialAmount = specialQty * specialPrice;
            document.getElementById('specialAmount').value = specialAmount;
            
            // 加班費用
            const overtimeQty = parseFloat(document.getElementById('overtimeQty').value) || 0;
            const overtimePrice = parseFloat(document.getElementById('overtimePrice').value) || 0;
            const overtimeAmount = overtimeQty * overtimePrice;
            document.getElementById('overtimeAmount').value = overtimeAmount;
            
            // 行政執行費 (人事支援金額的10%)
            const adminAmount = personnelAmount * 0.1;
            document.getElementById('adminAmount').value = adminAmount;
            
            // 其他費用
            const otherAmount = parseFloat(document.getElementById('otherAmount').value) || 0;
            
            // 計算總費用
            let subtotal = personnelAmount + specialAmount + overtimeAmount + adminAmount + otherAmount;
            
            // 加上其他動態添加的費用項目
            const feeRows = document.querySelectorAll('#feeTable tr:not(#personnelSupportRow):not(#adminFeeRow)');
            feeRows.forEach(row => {
                const amountInput = row.querySelector('td:nth-child(5) input');
                if (amountInput && amountInput.id !== 'specialAmount' && 
                    amountInput.id !== 'overtimeAmount' && 
                    amountInput.id !== 'otherAmount') {
                    subtotal += parseFloat(amountInput.value) || 0;
                }
            });
            
            // 更新小計和總計
            document.getElementById('subtotal').textContent = formatNumber(subtotal);
            document.getElementById('total').textContent = formatNumber(subtotal);
            
            // 同步更新第二頁的活動費用計算
            calculateAllActivityFees();
        }
        
        // 新增費用項目
        function addFeeItem() {
            const feeTable = document.getElementById('feeTable');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td><input type="text" placeholder="項目名稱" class="w-full"></td>
                <td><input type="number" placeholder="數量" class="w-full text-center" onchange="calculateFees()"></td>
                <td><input type="number" placeholder="單價" class="w-full text-center" onchange="calculateFees()"></td>
                <td><input type="text" placeholder="描述" class="w-full"></td>
                <td><input type="number" value="0" class="w-full text-right" onchange="calculateFees()"></td>
                <td class="text-center nowrap">
                    <button class="text-red-500 hover:text-red-700" onclick="removeRow(this)">
                        ✕
                    </button>
                </td>
            `;
            
            feeTable.appendChild(newRow);
        }
        
        // 新增活動項目
        function addActivityItem() {
            const activityTable = document.getElementById('activityTable');
            const activityTableContinued = document.getElementById('activityTableContinued');
            
            // 決定要添加到哪個表格
            let targetTable = activityTable;
            if (activityTable.rows.length >= 10) {
                targetTable = activityTableContinued;
                // 如果是第一次添加到續頁，顯示第三頁
                if (activityTableContinued.rows.length === 0) {
                    showPage(3);
                }
            }
            
            // 創建新行
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td><input type="text" placeholder="MM/DD" class="activity-date"></td>
                <td><input type="text" placeholder="活動地點" class="activity-location"></td>
                <td><input type="number" value="1" min="1" class="activity-qty text-center" onchange="calculateActivityFees(this)"></td>
                <td><input type="text" placeholder="HH:MM" class="activity-start-time text-center"></td>
                <td><input type="text" placeholder="HH:MM" class="activity-end-time text-center"></td>
                <td class="special-work-cell">
                    <input type="number" value="0" min="0" class="activity-special-qty" onchange="calculateActivityFees(this)">
                    <div class="special-work-checkboxes">
                        <label><input type="checkbox" class="activity-height"> 高</label>
                        <label><input type="checkbox" class="activity-spotlight"> 追</label>
                        <label><input type="checkbox" class="activity-control"> 控</label>
                    </div>
                </td>
                <td>
                    <div class="stepper">
                        <div class="stepper-btn" onclick="adjustOvertime(this, -0.5)">-</div>
                        <input type="number" value="0" step="0.5" min="0" class="stepper-input activity-overtime-hours" onchange="validateOvertime(this); calculateActivityFees(this)">
                        <div class="stepper-btn" onclick="adjustOvertime(this, 0.5)">+</div>
                    </div>
                </td>
                <td><input type="number" value="2500" class="activity-amount text-right" readonly></td>
                <td class="text-center nowrap">
                    <button class="text-red-500 hover:text-red-700" onclick="removeActivityRow(this)">
                        ✕
                    </button>
                </td>
            `;
            
            targetTable.appendChild(newRow);
            
            calculateAllActivityFees();
        }
        
        // 調整加班時數
        function adjustOvertime(btn, change) {
            const input = btn.parentNode.querySelector('input');
            let value = parseFloat(input.value) || 0;
            value += change;
            
            // 確保值不小於0且是0.5的倍數
            if (value < 0) value = 0;
            
            // 四捨五入到最接近的0.5倍數
            value = Math.round(value * 2) / 2;
            
            input.value = value;
            calculateActivityFees(input);
        }
        
        // 驗證加班時數
        function validateOvertime(input) {
            let value = parseFloat(input.value) || 0;
            
            // 確保值不小於0且是0.5的倍數
            if (value < 0) value = 0;
            
            // 四捨五入到最接近的0.5倍數
            value = Math.round(value * 2) / 2;
            
            input.value = value;
        }
        
        // 計算單個活動費用
        function calculateActivityFees(element) {
            // 找到包含此元素的行
            let row = element.closest('tr');
            
            const basePrice = 2500; // 基本費用
            const specialPrice = 1000; // 特殊工作費用
            const overtimeHourlyRate = 350; // 加班時薪
            
            const qty = parseFloat(row.querySelector('.activity-qty').value) || 1;
            const specialQty = parseFloat(row.querySelector('.activity-special-qty').value) || 0;
            const overtimeHours = parseFloat(row.querySelector('.activity-overtime-hours').value) || 0;
            
            let totalAmount = basePrice * qty;
            totalAmount += specialQty * specialPrice;
            totalAmount += overtimeHours * overtimeHourlyRate;
            
            row.querySelector('.activity-amount').value = totalAmount;
            
            // 更新活動總計
            calculateAllActivityFees();
            
            // 更新第一頁的加班總時數和特殊工作總人數
            updateTotalOvertimeHours();
            updateTotalSpecialQty();
        }
        
        // 更新加班總時數
        function updateTotalOvertimeHours() {
            let totalOvertimeHours = 0;
            
            // 計算第一頁活動的加班時數
            const activityRows = document.querySelectorAll('#activityTable tr');
            activityRows.forEach(row => {
                const overtimeInput = row.querySelector('.activity-overtime-hours');
                if (overtimeInput) {
                    totalOvertimeHours += parseFloat(overtimeInput.value) || 0;
                }
            });
            
            // 計算續頁活動的加班時數
            const activityRowsContinued = document.querySelectorAll('#activityTableContinued tr');
            activityRowsContinued.forEach(row => {
                const overtimeInput = row.querySelector('.activity-overtime-hours');
                if (overtimeInput) {
                    totalOvertimeHours += parseFloat(overtimeInput.value) || 0;
                }
            });
            
            // 更新第一頁的加班時數
            document.getElementById('overtimeQty').value = totalOvertimeHours;
            calculateFees();
        }
        
        // 更新特殊工作總人數
        function updateTotalSpecialQty() {
            let totalSpecialQty = 0;
            
            // 計算第一頁活動的特殊工作人數
            const activityRows = document.querySelectorAll('#activityTable tr');
            activityRows.forEach(row => {
                const specialQtyInput = row.querySelector('.activity-special-qty');
                if (specialQtyInput) {
                    totalSpecialQty += parseFloat(specialQtyInput.value) || 0;
                }
            });
            
            // 計算續頁活動的特殊工作人數
            const activityRowsContinued = document.querySelectorAll('#activityTableContinued tr');
            activityRowsContinued.forEach(row => {
                const specialQtyInput = row.querySelector('.activity-special-qty');
                if (specialQtyInput) {
                    totalSpecialQty += parseFloat(specialQtyInput.value) || 0;
                }
            });
            
            // 更新第一頁的特殊工作人數
            document.getElementById('specialQty').value = totalSpecialQty;
            calculateFees();
        }
        
        // 計算所有活動費用總和
        function calculateAllActivityFees() {
            let activityTotal = 0;
            
            // 計算第一頁活動
            const activityRows = document.querySelectorAll('#activityTable tr');
            activityRows.forEach(row => {
                const amountInput = row.querySelector('.activity-amount');
                if (amountInput) {
                    activityTotal += parseFloat(amountInput.value) || 0;
                }
            });
            
            // 計算續頁活動
            const activityRowsContinued = document.querySelectorAll('#activityTableContinued tr');
            activityRowsContinued.forEach(row => {
                const amountInput = row.querySelector('.activity-amount');
                if (amountInput) {
                    activityTotal += parseFloat(amountInput.value) || 0;
                }
            });
            
            // 更新活動總計
            document.getElementById('activityTotal').textContent = formatNumber(activityTotal);
        }
        
        // 移除行
        function removeRow(button) {
            const row = button.closest('tr');
            row.remove();
            calculateFees();
            calculateAllActivityFees();
            updateTotalOvertimeHours();
            updateTotalSpecialQty();
        }
        
        // 移除活動行
        function removeActivityRow(button) {
            const row = button.closest('tr');
            row.remove();
            
            calculateAllActivityFees();
            updateTotalOvertimeHours();
            updateTotalSpecialQty();
        }
        
        // 格式化數字為千分位
        function formatNumber(num) {
            return num.toLocaleString('zh-TW');
        }
        
        // 下載PDF
        function downloadPDF() {
            alert('PDF下載功能將在實際應用中實現');
            window.print();
        }
        
        // 重製表單
        function resetForm() {
            if (confirm('確定要重製表單嗎？所有已輸入的資料將被清除。')) {
                location.reload();
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'94924d75456ade67',t:'MTc0ODgxODU2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
